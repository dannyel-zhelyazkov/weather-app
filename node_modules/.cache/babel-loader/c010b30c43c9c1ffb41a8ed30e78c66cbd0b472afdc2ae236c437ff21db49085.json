{"ast":null,"code":"import { createSlice } from \"@reduxjs/toolkit\";\nimport { forecastService, weatherService } from \"../../api\";\nimport { STANDARD_UNIT, WEATHER_METRIC_KEY } from \"../../common/constants\";\nimport { parseWeatherForecastData } from \"../../utils\";\nconst initialState = {\n  locationName: \"\",\n  units: \"\",\n  weather: {},\n  isLoading: undefined\n};\nexport const weatherSlice = createSlice({\n  name: \"weather\",\n  initialState,\n  reducers: {\n    setWeatherAndForecast: (state, action) => {\n      state.locationName = action.payload.weatherData.name;\n      state.weather = parseWeatherForecastData({\n        weatherData: action.payload.weatherData,\n        forecastData: action.payload.forecastData\n      });\n      state.units = action.payload.units;\n      state.isLoading = false;\n    },\n    setWeather: (state, action) => {\n      const newObject = {\n        ...state.weather\n      };\n      newObject[0].weather = action.payload;\n      state.weather = newObject;\n    },\n    setUnits: (state, action) => {\n      localStorage.setItem(WEATHER_METRIC_KEY, action.payload);\n      state.units = action.payload;\n    },\n    setIsLoading: (state, action) => {\n      state.isLoading = action.payload;\n    }\n  }\n});\nexport const fetchWeather = () => dispatch => {\n  try {\n    dispatch(setIsLoading(true));\n    navigator.geolocation.getCurrentPosition(async position => {\n      const lat = position.coords.latitude;\n      const lon = position.coords.longitude;\n      const units = localStorage.getItem(WEATHER_METRIC_KEY) || STANDARD_UNIT;\n      const responseWeather = await weatherService().getWeather({\n        lat,\n        lon,\n        units\n      });\n      dispatch(setWeather({\n        weatherData: responseWeather\n      }));\n    });\n  } catch (e) {\n    dispatch(setIsLoading(false));\n  }\n};\nexport const fetchWeatherAndForecast = () => dispatch => {\n  try {\n    dispatch(setIsLoading(true));\n    navigator.geolocation.getCurrentPosition(async position => {\n      const lat = position.coords.latitude;\n      const lon = position.coords.longitude;\n      const units = localStorage.getItem(WEATHER_METRIC_KEY) || STANDARD_UNIT;\n      const responseWeather = await weatherService().getWeather({\n        lat,\n        lon,\n        units\n      });\n      const responseForecast = await forecastService().getForecast({\n        lat,\n        lon,\n        units\n      });\n      dispatch(setWeatherAndForecast({\n        units,\n        weatherData: responseWeather,\n        forecastData: responseForecast\n      }));\n    });\n  } catch (e) {\n    dispatch(setIsLoading(false));\n  }\n};\nexport const {\n  setWeatherAndForecast,\n  setIsLoading,\n  setWeather,\n  setUnits\n} = weatherSlice.actions;\nexport const weatherReducer = weatherSlice.reducer;","map":{"version":3,"names":["createSlice","forecastService","weatherService","STANDARD_UNIT","WEATHER_METRIC_KEY","parseWeatherForecastData","initialState","locationName","units","weather","isLoading","undefined","weatherSlice","name","reducers","setWeatherAndForecast","state","action","payload","weatherData","forecastData","setWeather","newObject","setUnits","localStorage","setItem","setIsLoading","fetchWeather","dispatch","navigator","geolocation","getCurrentPosition","position","lat","coords","latitude","lon","longitude","getItem","responseWeather","getWeather","e","fetchWeatherAndForecast","responseForecast","getForecast","actions","weatherReducer","reducer"],"sources":["/Users/maistor_dany/Projects/weather-app/src/store/weather/weather.slice.ts"],"sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\nimport { AppDispatch, WeatherData } from \"../index\";\nimport {\n  ForecastResponse,\n  forecastService,\n  WeatherResponse,\n  weatherService,\n} from \"../../api\";\nimport { STANDARD_UNIT, WEATHER_METRIC_KEY } from \"../../common/constants\";\nimport { parseWeatherForecastData } from \"../../utils\";\n\nexport type WeatherState = {\n  locationName: string;\n  units: string;\n  weather: WeatherData;\n  isLoading?: boolean;\n};\n\nconst initialState: WeatherState = {\n  locationName: \"\",\n  units: \"\",\n  weather: {},\n  isLoading: undefined,\n};\n\nexport const weatherSlice = createSlice({\n  name: \"weather\",\n  initialState,\n  reducers: {\n    setWeatherAndForecast: (\n      state,\n      action: {\n        payload: {\n          units: string;\n          weatherData: WeatherResponse;\n          forecastData: ForecastResponse;\n        };\n      },\n    ) => {\n      state.locationName = action.payload.weatherData.name;\n      state.weather = parseWeatherForecastData({\n        weatherData: action.payload.weatherData,\n        forecastData: action.payload.forecastData,\n      });\n      state.units = action.payload.units;\n      state.isLoading = false;\n    },\n    setWeather: (state, action) => {\n      const newObject = { ...state.weather };\n      newObject[0].weather = action.payload;\n\n      state.weather = newObject;\n    },\n    setUnits: (state, action) => {\n      localStorage.setItem(WEATHER_METRIC_KEY, action.payload);\n      state.units = action.payload;\n    },\n    setIsLoading: (state, action) => {\n      state.isLoading = action.payload;\n    },\n  },\n});\n\nexport const fetchWeather = () => (dispatch: AppDispatch) => {\n  try {\n    dispatch(setIsLoading(true));\n    navigator.geolocation.getCurrentPosition(async (position) => {\n      const lat = position.coords.latitude;\n      const lon = position.coords.longitude;\n\n      const units = localStorage.getItem(WEATHER_METRIC_KEY) || STANDARD_UNIT;\n      const responseWeather = await weatherService().getWeather({\n        lat,\n        lon,\n        units,\n      });\n\n      dispatch(\n        setWeather({\n          weatherData: responseWeather,\n        }),\n      );\n    });\n  } catch (e) {\n    dispatch(setIsLoading(false));\n  }\n};\n\nexport const fetchWeatherAndForecast = () => (dispatch: AppDispatch) => {\n  try {\n    dispatch(setIsLoading(true));\n    navigator.geolocation.getCurrentPosition(async (position) => {\n      const lat = position.coords.latitude;\n      const lon = position.coords.longitude;\n\n      const units = localStorage.getItem(WEATHER_METRIC_KEY) || STANDARD_UNIT;\n      const responseWeather = await weatherService().getWeather({\n        lat,\n        lon,\n        units,\n      });\n      const responseForecast = await forecastService().getForecast({\n        lat,\n        lon,\n        units,\n      });\n\n      dispatch(\n        setWeatherAndForecast({\n          units,\n          weatherData: responseWeather,\n          forecastData: responseForecast,\n        }),\n      );\n    });\n  } catch (e) {\n    dispatch(setIsLoading(false));\n  }\n};\n\nexport const { setWeatherAndForecast, setIsLoading, setWeather, setUnits } =\n  weatherSlice.actions;\n\nexport const weatherReducer = weatherSlice.reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}