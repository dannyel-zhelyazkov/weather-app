{"ast":null,"code":"import { createSlice } from \"@reduxjs/toolkit\";\nimport { forecastService, weatherService } from \"../../api\";\nimport { STANDARD_UNIT, WEATHER_METRIC_KEY } from \"../../common/constants\";\nimport { parseWeatherForecastData } from \"../../utils\";\nconst initialState = {\n  locationName: \"\",\n  units: \"\",\n  weather: {},\n  isLoading: undefined\n};\nexport const weatherSlice = createSlice({\n  name: \"weather\",\n  initialState,\n  reducers: {\n    setWeatherAndForecast: (state, action) => {\n      state.locationName = action.payload.weatherData.name;\n      state.weather = parseWeatherForecastData({\n        weatherData: action.payload.weatherData,\n        forecastData: action.payload.forecastData\n      });\n      state.units = action.payload.units;\n      state.isLoading = false;\n    },\n    setUnits: (state, action) => {\n      localStorage.setItem(WEATHER_METRIC_KEY, action.payload);\n      state.units = action.payload;\n    },\n    setIsLoading: (state, action) => {\n      state.isLoading = action.payload;\n    }\n  }\n});\nexport const fetchWeather = () => dispatch => {\n  try {\n    dispatch(setIsLoading(true));\n    navigator.geolocation.getCurrentPosition(async position => {\n      const lat = position.coords.latitude;\n      const lon = position.coords.longitude;\n      const units = localStorage.getItem(WEATHER_METRIC_KEY) || STANDARD_UNIT;\n      const responseWeather = await weatherService().getWeather({\n        lat,\n        lon,\n        units\n      });\n      const responseForecast = await forecastService().getForecast({\n        lat,\n        lon,\n        units\n      });\n      dispatch(setWeatherAndForecast({\n        units,\n        weatherData: responseWeather,\n        forecastData: responseForecast\n      }));\n    });\n  } catch (e) {\n    dispatch(setIsLoading(false));\n  }\n};\nexport const {\n  setWeatherAndForecast,\n  setIsLoading,\n  setUnits\n} = weatherSlice.actions;\nexport const weatherReducer = weatherSlice.reducer;","map":{"version":3,"names":["createSlice","forecastService","weatherService","STANDARD_UNIT","WEATHER_METRIC_KEY","parseWeatherForecastData","initialState","locationName","units","weather","isLoading","undefined","weatherSlice","name","reducers","setWeatherAndForecast","state","action","payload","weatherData","forecastData","setUnits","localStorage","setItem","setIsLoading","fetchWeather","dispatch","navigator","geolocation","getCurrentPosition","position","lat","coords","latitude","lon","longitude","getItem","responseWeather","getWeather","responseForecast","getForecast","e","actions","weatherReducer","reducer"],"sources":["/Users/maistor_dany/Projects/weather-app/src/store/weather/weather.slice.ts"],"sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\nimport { AppDispatch, WeatherData } from \"../index\";\nimport {\n  ForecastResponse,\n  forecastService,\n  WeatherResponse,\n  weatherService,\n} from \"../../api\";\nimport { STANDARD_UNIT, WEATHER_METRIC_KEY } from \"../../common/constants\";\nimport { parseWeatherForecastData } from \"../../utils\";\n\nexport type WeatherState = {\n  locationName: string;\n  units: string;\n  weather: WeatherData;\n  isLoading?: boolean;\n};\n\nconst initialState: WeatherState = {\n  locationName: \"\",\n  units: \"\",\n  weather: {},\n  isLoading: undefined,\n};\n\nexport const weatherSlice = createSlice({\n  name: \"weather\",\n  initialState,\n  reducers: {\n    setWeatherAndForecast: (\n      state,\n      action: {\n        payload: {\n          units: string;\n          weatherData: WeatherResponse;\n          forecastData: ForecastResponse;\n        };\n      },\n    ) => {\n      state.locationName = action.payload.weatherData.name;\n      state.weather = parseWeatherForecastData({\n        weatherData: action.payload.weatherData,\n        forecastData: action.payload.forecastData,\n      });\n      state.units = action.payload.units;\n      state.isLoading = false;\n    },\n    setUnits: (state, action) => {\n      localStorage.setItem(WEATHER_METRIC_KEY, action.payload);\n      state.units = action.payload;\n    },\n    setIsLoading: (state, action) => {\n      state.isLoading = action.payload;\n    },\n  },\n});\n\nexport const fetchWeather = () => (dispatch: AppDispatch) => {\n  try {\n    dispatch(setIsLoading(true));\n    navigator.geolocation.getCurrentPosition(async (position) => {\n      const lat = position.coords.latitude;\n      const lon = position.coords.longitude;\n\n      const units = localStorage.getItem(WEATHER_METRIC_KEY) || STANDARD_UNIT;\n      const responseWeather = await weatherService().getWeather({\n        lat,\n        lon,\n        units,\n      });\n      const responseForecast = await forecastService().getForecast({\n        lat,\n        lon,\n        units,\n      });\n\n      dispatch(\n        setWeatherAndForecast({\n          units,\n          weatherData: responseWeather,\n          forecastData: responseForecast,\n        }),\n      );\n    });\n  } catch (e) {\n    dispatch(setIsLoading(false));\n  }\n};\n\nexport const { setWeatherAndForecast, setIsLoading, setUnits } =\n  weatherSlice.actions;\n\nexport const weatherReducer = weatherSlice.reducer;\n"],"mappings":"AAAA,SAASA,WAAW,QAAQ,kBAAkB;AAE9C,SAEEC,eAAe,EAEfC,cAAc,QACT,WAAW;AAClB,SAASC,aAAa,EAAEC,kBAAkB,QAAQ,wBAAwB;AAC1E,SAASC,wBAAwB,QAAQ,aAAa;AAStD,MAAMC,YAA0B,GAAG;EACjCC,YAAY,EAAE,EAAE;EAChBC,KAAK,EAAE,EAAE;EACTC,OAAO,EAAE,CAAC,CAAC;EACXC,SAAS,EAAEC;AACb,CAAC;AAED,OAAO,MAAMC,YAAY,GAAGZ,WAAW,CAAC;EACtCa,IAAI,EAAE,SAAS;EACfP,YAAY;EACZQ,QAAQ,EAAE;IACRC,qBAAqB,EAAEA,CACrBC,KAAK,EACLC,MAMC,KACE;MACHD,KAAK,CAACT,YAAY,GAAGU,MAAM,CAACC,OAAO,CAACC,WAAW,CAACN,IAAI;MACpDG,KAAK,CAACP,OAAO,GAAGJ,wBAAwB,CAAC;QACvCc,WAAW,EAAEF,MAAM,CAACC,OAAO,CAACC,WAAW;QACvCC,YAAY,EAAEH,MAAM,CAACC,OAAO,CAACE;MAC/B,CAAC,CAAC;MACFJ,KAAK,CAACR,KAAK,GAAGS,MAAM,CAACC,OAAO,CAACV,KAAK;MAClCQ,KAAK,CAACN,SAAS,GAAG,KAAK;IACzB,CAAC;IACDW,QAAQ,EAAEA,CAACL,KAAK,EAAEC,MAAM,KAAK;MAC3BK,YAAY,CAACC,OAAO,CAACnB,kBAAkB,EAAEa,MAAM,CAACC,OAAO,CAAC;MACxDF,KAAK,CAACR,KAAK,GAAGS,MAAM,CAACC,OAAO;IAC9B,CAAC;IACDM,YAAY,EAAEA,CAACR,KAAK,EAAEC,MAAM,KAAK;MAC/BD,KAAK,CAACN,SAAS,GAAGO,MAAM,CAACC,OAAO;IAClC;EACF;AACF,CAAC,CAAC;AAEF,OAAO,MAAMO,YAAY,GAAGA,CAAA,KAAOC,QAAqB,IAAK;EAC3D,IAAI;IACFA,QAAQ,CAACF,YAAY,CAAC,IAAI,CAAC,CAAC;IAC5BG,SAAS,CAACC,WAAW,CAACC,kBAAkB,CAAC,MAAOC,QAAQ,IAAK;MAC3D,MAAMC,GAAG,GAAGD,QAAQ,CAACE,MAAM,CAACC,QAAQ;MACpC,MAAMC,GAAG,GAAGJ,QAAQ,CAACE,MAAM,CAACG,SAAS;MAErC,MAAM3B,KAAK,GAAGc,YAAY,CAACc,OAAO,CAAChC,kBAAkB,CAAC,IAAID,aAAa;MACvE,MAAMkC,eAAe,GAAG,MAAMnC,cAAc,CAAC,CAAC,CAACoC,UAAU,CAAC;QACxDP,GAAG;QACHG,GAAG;QACH1B;MACF,CAAC,CAAC;MACF,MAAM+B,gBAAgB,GAAG,MAAMtC,eAAe,CAAC,CAAC,CAACuC,WAAW,CAAC;QAC3DT,GAAG;QACHG,GAAG;QACH1B;MACF,CAAC,CAAC;MAEFkB,QAAQ,CACNX,qBAAqB,CAAC;QACpBP,KAAK;QACLW,WAAW,EAAEkB,eAAe;QAC5BjB,YAAY,EAAEmB;MAChB,CAAC,CACH,CAAC;IACH,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOE,CAAC,EAAE;IACVf,QAAQ,CAACF,YAAY,CAAC,KAAK,CAAC,CAAC;EAC/B;AACF,CAAC;AAED,OAAO,MAAM;EAAET,qBAAqB;EAAES,YAAY;EAAEH;AAAS,CAAC,GAC5DT,YAAY,CAAC8B,OAAO;AAEtB,OAAO,MAAMC,cAAc,GAAG/B,YAAY,CAACgC,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}